<% content_for :title, @organization %>
<div class="row">
  <div class="col-md-8">
    <%= render 'admin/application/summary/show', about: @organization %>
    <% if strip_tags(@organization.text.to_html).present? %>
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0"><%= University::Organization.human_attribute_name(:text) %></h5>
        </div>
        <div class="card-body">
          <%= @organization.text.to_s.html_safe %>
        </div>
      </div>
    <% end %>
    <div class="card flex-fill w-100">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <%= University::Organization.human_attribute_name('contact') %>
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <% [:address, :zipcode, :city, :country].each do |property| %>
              <% value = @organization.send property %>
              <% next if value.blank? %>
              <h3 class="h5">
                <%= University::Organization.human_attribute_name(property) %>
              </h3>
              <p><%= value %></p>
            <% end %>
          </div>
          <div class="col-md-6">
            <% unless @organization.url.blank? %>
              <h3 class="h5">
                <%= University::Organization.human_attribute_name(:url) %>
              </h3>
              <p><%= link_to  @organization.url,
                              @organization.url,
                              target: :_blank %></p>
            <% end %>
            <% [:phone, :email].each do |property| %>
              <% value = @organization.send property %>
              <% next if value.blank? %>
              <h3 class="h5">
                <%= University::Organization.human_attribute_name(property) %>
              </h3>
              <p><%= value %></p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="card flex-fill w-100">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <%= University::Organization.human_attribute_name('legal') %>
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h3 class="h5"><%= University::Organization.human_attribute_name(:long_name) %></h3>
            <p><%= @organization.long_name %></p>
          </div>
          <div class="col-md-6">
            <h3 class="h5"><%= University::Organization.human_attribute_name(:kind) %></h3>
            <p><%= @organization.kind_i18n %></p>
            <h3 class="h5"><%= University::Organization.human_attribute_name(:siren) %></h3>
            <p><%= @organization.siren %></p>
          </div>
        </div>
      </div>
    </div>
    <%= render 'admin/communication/blocks/list', about: @organization %>
  </div>
  <div class="col-md-4">
    <div class="card flex-fill w-100">
      <div class="card-header">
        <h5 class="card-title mb-0"><%= t('informations') %></h5>
      </div>
      <div class="card-body">
        <h3 class="h5"><%= University::Organization.human_attribute_name(:slug) %></h3>
        <p><%= @organization.slug %></p>
        <h3 class="h5"><%= University::Organization.human_attribute_name(:active) %></h3>
        <%= @organization.active %>
      </div>
    </div>
    <% if @organization.logo.attached? || @organization.logo_on_dark_background.attached? %>
      <div class="card flex-fill w-100">
        <div class="card-header">
          <h5 class="card-title mb-0"><%= t 'university.organization.logo' %></h5>
        </div>
        <div class="card-body">
          <% if @organization.logo.attached? %>
            <label class="form-label"><%= University::Organization.human_attribute_name('logo') %></label>
            <%= kamifusen_tag @organization.logo, class: 'img-fluid img-fill bg-light img-thumbnail p-5' %>
          <% end %>
          <% if @organization.logo_on_dark_background.attached? %>
            <label class="form-label mt-4"><%= University::Organization.human_attribute_name('logo_on_dark_background') %></label>
            <%= kamifusen_tag @organization.logo_on_dark_background, class: 'img-fluid img-fill bg-dark img-thumbnail p-5' %>
          <% end %>
        </div>
      </div>
    <% end %>
    <% if @organization.description.present? %>
      <div class="card flex-fill w-100">
        <div class="card-header">
          <h5 class="card-title mb-0"><%= t('seo') %></h5>
        </div>
        <div class="card-body">
          <h3 class="h5"><%= University::Organization.human_attribute_name('description') %></h3>
          <%= simple_format @organization.description %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% if @organization.experiences.any? %>
  <h2><%= t('university.organization.employees') %></h2>

  <div class="table-responsive">
    <table class="<%= table_classes %>">
      <thead>
        <tr>
          <th><%= University::Person.human_attribute_name('last_name') %></th>
          <th><%= University::Person.human_attribute_name('first_name') %></th>
          <th><%= t('university.person.experience.period') %></th>
        </tr>
      </thead>
      <tbody>
        <% @organization.experiences.ordered.each do |experience| %>
          <%
            alumnus = experience.person
            path = admin_university_alumnus_path(alumnus)
          %>
          <tr>
            <td><%= link_to_if can?(:read, alumnus), alumnus.last_name, path %></td>
            <td><%= link_to_if can?(:read, alumnus), alumnus.first_name, path %></td>
            <td>
              <%= "#{experience.from_year} - #{experience.to_year.present? ? experience.to_year : t('today')}" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>

<% content_for :action_bar_left do %>
  <%= destroy_link @organization %>
  <%= link_to t('static'),
              static_admin_university_organization_path(@organization),
              target: :_blank,
              class: button_classes('btn-light') if current_user.server_admin? %>
<% end %>

<% content_for :action_bar_right do %>
  <%= edit_link @organization %>
<% end %>
