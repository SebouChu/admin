<% content_for :title, t('admin.dashboard') %>
<% classes = 'col-md-6 col-xl-4 d-flex' %>

<div class="row mb-5">
  <div class="col-md-6 pb-4">
    <%= osuny_panel t('hello', name: current_user.first_name) do %>
      <% if current_admin_theme == 'appstack' %>
        <p>
          Osuny a un nouveau thème pour l'administration, "Pure". <br>
          Voulez-vous l'essayer ?
        </p>
        <%= link_to 'Changer de thème', admin_set_theme_path(theme: 'pure'), method: :put %>
      <% else %>
        <p>
          Vous utilisez le thème "Pure" pour l'administration. <br>
          Voulez-vous revenir au thème "Appstack" ?
        </p>
        <%= link_to 'Changer de thème', admin_set_theme_path(theme: 'appstack'), method: :put %>
      <% end %>
      <div class="text-end">
        <% if current_university.logo.attached? %>
          <%= image_tag current_university.logo, width: 120 %>
        <% else %>
          <%= current_university %>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="col-md-6 pb-4">
    <%= osuny_panel Delayed::Job.all.length, 
              action: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock align-baseline"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>' do %>
      <p class="mb-0"><%= t 'admin.pending_tasks.label' %></p>
      <p class="mb-0 small"><%= t 'admin.pending_tasks.hint' %></p>
    <% end %>
  </div>
</div>

<% if current_university.communication_websites.any? && can?(:read, Communication::Website) %>
  <h2 class="category"><%= Communication::Website.model_name.human(count: 2) %></h2>
  <div class="row">
    <% current_university.communication_websites.each do |website| %>
      <% next unless can?(:read, website) %>
      <div class="<%= classes %>">
        <%= osuny_panel website, 
                  action: "<i class=\"fas fa-#{ Icon::COMMUNICATION_WEBSITE }\"></i>" do %>
          <p class="small"><%= website.url %></p>
          <%= link_to t('show'), [:admin, website], class: button_classes('stretched-link') %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<% if current_university.communication_extranets.any? && can?(:read, Communication::Extranet) %>
  <h2 class="category"><%= Communication::Extranet.model_name.human(count: 2) %></h2>
  <div class="row">
    <% current_university.communication_extranets.each do |extranet| %>
      <% next unless can?(:read, extranet) %>
      <div class="<%= classes %>">
        <%= osuny_panel extranet, 
                  action: "<i class=\"fas fa-#{ Icon::COMMUNICATION_EXTRANET }\"></i>" do %>
          <p class="small"><%= extranet.url %></p>
          <%= link_to t('show'), [:admin, extranet], class: button_classes('stretched-link') %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<% if current_university.research_journals.any? && can?(:read, Research::Journal) %>
  <h2 class="category"><%= Research::Journal.model_name.human(count: 2) %></h2>
  <div class="row pure__row--small">
    <% current_university.research_journals.each do |journal| %>
      <% next unless can?(:read, journal) %>
      <div class="<%= classes %>">
        <%= osuny_panel journal, 
            action: "<i class=\"fas fa-#{ Icon::RESEARCH_JOURNAL }\"></i>" do %>
          <%= link_to t('show'), [:admin, journal], class: button_classes('stretched-link') %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<% if current_admin_theme == 'appstack' %>
  <div class="small mt-5">
    <ul class="list-inline">
      <li class="list-inline-item">
        <%= link_to 'API', api_root_path %>
      </li>
      <%
      [
      :terms_of_service,
      :privacy_policy,
      :cookies_policy
      ].each do |term| %>
        <li class="list-inline-item">
          <%= link_to t("#{term}"), t("#{term}_url"), target: '_blank', rel: 'noreferrer' %>
        </li>
      <% end %>
      <li class="list-inline-item">
        <%= link_to t('cookies_consent_choice'), '', class: 'js-gdpr__cookie_consent__display_again' %>
      </li>
    </ul>
  </div>
<% end %>
