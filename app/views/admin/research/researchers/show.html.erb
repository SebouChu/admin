<% content_for :title, @researcher %>

<%= render 'admin/university/people/main_infos', person: @researcher %>

<% if @papers.total_count > 0 %>
  <div class="card">
    <div class="card-header">
      <h2 class="card-title mb-0 h5"><%= "#{Research::Journal::Paper.model_name.human(count: 2)} (#{@papers.total_count})" %></h2>
    </div>
    <%= render 'admin/research/journals/papers/list', papers: @papers %>
    <% if @papers.total_pages > 1 %>
      <div class="card-footer">
        <%= paginate @papers, theme: 'bootstrap-5' %>
      </div>
    <% end %>
  </div>
<% end %>

<% content_for :action_bar_right do %>
  <%= edit_link @researcher %>
<% end %>


<% if @researcher.hal_person_identifier.present? %>
  <h2 class="h4 mt-5">Publications</h2>
  <%
  url = "https://api.archives-ouvertes.fr/search/?q=authIdPerson_i:#{@researcher.hal_person_identifier}&fl=title_s,citationRef_s,uri_s&rows=1000"
  uri = URI(url)
  response = Net::HTTP.get(uri)
  data = JSON.parse(response)
  %>
  <table class="table">
    <thead>
      <tr>
        <th>Titre</th>
        <th>Source</th>
        <th>URL</th>
      </tr>
    </thead>
    <tbody>
      <% data['response']['docs'].each do |doc| %>
        <tr>
          <td><%= sanitize doc['title_s'][0] %></td>
          <td><%= sanitize doc['citationRef_s'] %></td>
          <td><%= link_to t('show'), doc['uri_s'], target: :_blank %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>