<% content_for :title, @volume %>

<div class="row">
  <div class="col-md-8">
    <div class="card flex-fill w-100">
      <div class="card-header">
        <h2 class="card-title mb-0 h5"><%= t('content') %></h2>
      </div>
      <div class="card-body">
        <h3 class="h5"><%= Research::Journal::Volume.human_attribute_name('description') %></h3>
        <p><%= @volume.description %></p>
        <% if @articles.any? %>
          <h3 class="h5 mt-4"><%= Research::Journal::Volume.human_attribute_name('articles') %></h3>
          <table class="table table-sortable">
            <thead>
              <tr>
                <% if can? :reorder, Research::Journal::Article %>
                  <th width="20" class="ps-0">&nbsp;</th>
                <% end %>
                <th class="ps-0"><%= Research::Journal::Article.model_name.human %></th>
                <th><%= Research::Journal::Article.human_attribute_name('published_at') %></th>
                <th></th>
              </tr>
            </thead>
            <tbody data-reorder-url="<%= reorder_admin_research_journal_articles_path(journal_id: @journal.id) %>">
              <% @articles.each do |article| %>
                <tr data-id="<%= article.id %>">
                  <% if can? :reorder, Research::Journal::Article %>
                    <td><i class="fa fa-bars handle"></i></td>
                  <% end %>
                  <td>
                    <%= link_to article,
                                admin_research_journal_article_path(journal_id: article.journal, id: article),
                                class: "#{'opacity-50' unless article.published?}" %>
                  </td>
                  <td><%= article.published_at %></td>
                  <td class="text-end">
                    <div class="btn-group" role="group">
                      <%= link_to t('edit'),
                                  edit_admin_research_journal_article_path(journal_id: article.journal, id: article),
                                  class: button_classes %>
                      <%= link_to t('delete'),
                                  admin_research_journal_article_path(journal_id: article.journal, id: article),
                                  method: :delete,
                                  data: { confirm: t('please_confirm') },
                                  class: button_classes_danger %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card flex-fill w-100">
      <div class="card-header">
        <h2 class="card-title mb-0 h5"><%= t('metadata') %></h2>
      </div>
      <div class="card-body">
        <h3 class="h5"><%= Research::Journal::Volume.human_attribute_name('number') %></h3>
        <p><%= @volume.number %></p>
        <h3 class="h5"><%= Research::Journal::Volume.human_attribute_name('published_at') %></h3>
        <p><%= l @volume.published_at.to_time, format: :date_with_explicit_month if @volume.published_at %></p>
      </div>
    </div>
    <% if @volume.featured_image.attached? %>
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><%= Research::Journal::Volume.human_attribute_name('featured_image') %></h2>
        </div>
        <div class="card-body">
          <%= kamifusen_tag @volume.featured_image, class: 'img-fluid' %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% content_for :action_bar_right do %>
  <%= edit_link @volume %>
<% end %>
